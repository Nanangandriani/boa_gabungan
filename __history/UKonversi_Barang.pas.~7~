unit UKonversi_Barang;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, Vcl.Buttons,
  DBGridEhGrouping, ToolCtrlsEh, DBGridEhToolCtrls, DynVarsEh, RzCmboBx,
  Data.DB, MemDS, DBAccess, Uni, RzButton, EhLibVCL, GridsEh, DBAxisGridsEh,
  DBGridEh, RzTabs, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxRibbonSkins, dxRibbonCustomizationForm, dxBar,
  dxBarExtItems, cxClasses, dxRibbon, dxSkinsCore, dxSkinBlack, dxSkinBlue,
  dxSkinBlueprint, dxSkinCaramel, dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide,
  dxSkinDevExpressDarkStyle, dxSkinDevExpressStyle, dxSkinFoggy,
  dxSkinGlassOceans, dxSkinHighContrast, dxSkiniMaginary, dxSkinLilian,
  dxSkinLiquidSky, dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMetropolis,
  dxSkinMetropolisDark, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinOffice2010Black, dxSkinOffice2010Blue,
  dxSkinOffice2010Silver, dxSkinOffice2013DarkGray, dxSkinOffice2013LightGray,
  dxSkinOffice2013White, dxSkinPumpkin, dxSkinSeven, dxSkinSevenClassic,
  dxSkinSharp, dxSkinSharpPlus, dxSkinSilver, dxSkinSpringTime, dxSkinStardust,
  dxSkinSummer2008, dxSkinTheAsphaltWorld, dxSkinsDefaultPainters,
  dxSkinValentine, dxSkinVS2010, dxSkinWhiteprint, dxSkinXmas2008Blue,
  dxSkinsdxRibbonPainter, dxSkinsdxBarPainter, dxSkinBasic,
  dxSkinOffice2016Colorful, dxSkinOffice2016Dark, dxSkinOffice2019Black,
  dxSkinOffice2019Colorful, dxSkinOffice2019DarkGray, dxSkinOffice2019White,
  dxSkinTheBezier, dxSkinVisualStudio2013Blue, dxSkinVisualStudio2013Dark,
  dxSkinVisualStudio2013Light, dxCore;

type
  TFKonversi_Barang = class(TForm)
    QKonversiM: TUniQuery;
    DsKonversiM: TDataSource;
    dxBarManager1: TdxBarManager;
    dxRibbon1Tab1: TdxRibbonTab;
    dxRibbon1: TdxRibbon;
    dxBarManager1Bar1: TdxBar;
    dxBarButton1: TdxBarButton;
    dxBarButton2: TdxBarButton;
    dxBarButton3: TdxBarButton;
    dxBarButton4: TdxBarButton;
    dxBarBaru: TdxBarLargeButton;
    DBGridEh1: TDBGridEh;
    procedure BBaruClick(Sender: TObject);
    procedure BBatalClick(Sender: TObject);
    procedure dxBarButton2Click(Sender: TObject);
    procedure dxBarButton3Click(Sender: TObject);
    procedure dxBarBaruClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
  private
    { Private declarations }
    Procedure Refresh;
    procedure Clear;
  public
    { Public declarations }
    Procedure Autonumber;
  end;
function FKonversi_Barang:TFKonversi_Barang;
var
 // Fkonversimaterial: TFkonversimaterial;
  urut:integer;

implementation

{$R *.dfm}

uses UNew_KonvBarang, UDataModule;
var
  RealFKonversi_Barang : TFKonversi_Barang;

// implementasi function
function FKonversi_Barang: TFKonversi_Barang;
begin
  if RealFKonversi_Barang <> nil then
    FKonversi_Barang:= RealFKonversi_Barang
  else
    Application.CreateForm(TFKonversi_Barang, Result);
end;

procedure TFKonversi_Barang.Autonumber;
begin
  with dm.Qtemp do
  begin
    close;
    sql.Clear;
    sql.Text:=' SELECT max(t_konversi_material.no_konversi)AS urut FROM t_konversi_material';
    execsql;
  end;
   urut:=Dm.Qtemp.FieldByName('urut').AsInteger+1;
   FNew_KonvBarang.Edno.Text:=FloatToStr(urut);
end;

Procedure TFKonversi_Barang.Clear;
begin
  FNew_KonvBarang.EdKd.Text:='';
  FNew_KonvBarang.EdNm.Text:='';
  FNew_KonvBarang.Edqty.Text:='0';
  FNew_KonvBarang.Edsatuan.Text:='';
  FNew_KonvBarang.EdqtyKon.Text:='0';
  FNew_KonvBarang.EdKonversi.Text:='';
  FNew_KonvBarang.Edno.Text:='';
end;

procedure TFKonversi_Barang.dxBarBaruClick(Sender: TObject);
begin
  with FNew_KonvBarang do
  begin
    Show;
    Self.Clear;
  //  Self.Autonumber;
  // FNew_KonvBarang.BSimpan.Visible:=True;
  // FNew_KonvBarang.BEdit.Visible:=False;
    caption:='New Konversi Barang';
    Status:=0;
  end;
end;

procedure TFKonversi_Barang.dxBarButton2Click(Sender: TObject);
begin
  FNew_KonvBarang.Show;
  //FNew_KonvBarang.BSimpan.Visible:=False;
  //FNew_KonvBarang.BEdit.Visible:=True;
  FNew_KonvBarang.Caption:='Update Konversi Barang';
  Status:=1;
  with QKonversiM do
  begin
  //  FNew_KonvBarang.Edno.Text:=QKonversiM.FieldByName('no_konversi').AsString;
    FNew_KonvBarang.EdKd.Text:=QKonversiM.FieldByName('item_code').AsString;
    FNew_KonvBarang.EdNm.Text:=QKonversiM.FieldByName('item_name').AsString;
    FNew_KonvBarang.Edqty.Text:=QKonversiM.FieldByName('qtyu_nit').AsString;
    FNew_KonvBarang.Edsatuan.Text:=QKonversiM.FieldByName('unit').AsString;
    FNew_KonvBarang.EdqtyKon.Text:=QKonversiM.FieldByName('qty_conv').AsString;
    FNew_KonvBarang.EdKonversi.Text:=QKonversiM.FieldByName('unit_conv').AsString;
    FNew_KonvBarang.Edcategory.Text:=QKonversiM.FieldByName('category').AsString;
  end;
end;

procedure TFKonversi_Barang.dxBarButton3Click(Sender: TObject);
begin
  DBGridEh1.StartLoadingStatus();
  Self.Refresh;
  DBGridEh1.FinishLoadingStatus();
end;

procedure TFKonversi_Barang.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
//Dm.Koneksi.Close;
  Action:=cafree;
end;

procedure TFKonversi_Barang.FormCreate(Sender: TObject);
begin
  RealFKonversi_Barang:=self;
end;

procedure TFKonversi_Barang.FormDestroy(Sender: TObject);
begin
  RealFKonversi_Barang:=nil;
end;

procedure TFKonversi_Barang.FormShow(Sender: TObject);
begin
  Refresh;
end;

Procedure TFKonversi_Barang.Refresh;
begin
  QKonversiM.Close;
  QKonversiM.Open;
end;

procedure TFKonversi_Barang.BBaruClick(Sender: TObject);
begin
Self.Clear;
Self.Autonumber;
//Self.Load;
end;

procedure TFKonversi_Barang.BBatalClick(Sender: TObject);
begin
  Self.Clear;
  Self.Refresh;
end;


end.
