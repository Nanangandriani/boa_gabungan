unit UListPerusahaan;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, DBGridEhGrouping, ToolCtrlsEh,
  DBGridEhToolCtrls, DynVarsEh, dxSkinsCore, dxSkinBasic, dxSkinBlack,
  dxSkinBlue, dxSkinBlueprint, dxSkinCaramel, dxSkinCoffee, dxSkinDarkroom,
  dxSkinDarkSide, dxSkinDevExpressDarkStyle, dxSkinDevExpressStyle, dxSkinFoggy,
  dxSkinGlassOceans, dxSkinHighContrast, dxSkiniMaginary, dxSkinLilian,
  dxSkinLiquidSky, dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMetropolis,
  dxSkinMetropolisDark, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinOffice2010Black, dxSkinOffice2010Blue,
  dxSkinOffice2010Silver, dxSkinOffice2013DarkGray, dxSkinOffice2013LightGray,
  dxSkinOffice2013White, dxSkinOffice2016Colorful, dxSkinOffice2016Dark,
  dxSkinOffice2019Black, dxSkinOffice2019Colorful, dxSkinOffice2019DarkGray,
  dxSkinOffice2019White, dxSkinPumpkin, dxSkinSeven, dxSkinSevenClassic,
  dxSkinSharp, dxSkinSharpPlus, dxSkinSilver, dxSkinSpringtime, dxSkinStardust,
  dxSkinSummer2008, dxSkinTheAsphaltWorld, dxSkinTheBezier,
  dxSkinsDefaultPainters, dxSkinValentine, dxSkinVisualStudio2013Blue,
  dxSkinVisualStudio2013Dark, dxSkinVisualStudio2013Light, dxSkinVS2010,
  dxSkinWhiteprint, dxSkinXmas2008Blue, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxCore, dxRibbonSkins, dxRibbonCustomizationForm,
  Data.DB, MemDS, DBAccess, Uni, dxRibbon, dxBar, cxClasses, EhLibVCL, GridsEh,
  DBAxisGridsEh, DBGridEh, System.Actions, Vcl.ActnList,
  Vcl.PlatformDefaultStyleActnCtrls, Vcl.ActnMan;

type
  TFListPerusahaan = class(TForm)
    ActMenu: TActionManager;
    ActBaru: TAction;
    ActUpdate: TAction;
    ActRO: TAction;
    ActDel: TAction;
    ActPrint: TAction;
    ActApp: TAction;
    ActReject: TAction;
    ActClose: TAction;
    DBGridPerusahaan: TDBGridEh;
    dxBarManager1: TdxBarManager;
    dxBarManager1Bar1: TdxBar;
    dxBarButton2: TdxBarButton;
    dxBarButton1: TdxBarButton;
    dxBarButton3: TdxBarButton;
    dxBarButton4: TdxBarButton;
    dxBarButton5: TdxBarButton;
    dxBarButton6: TdxBarButton;
    dxBarButton7: TdxBarButton;
    dxBarBaru: TdxBarLargeButton;
    dxBarUpdate: TdxBarButton;
    dxbarRefresh: TdxBarButton;
    dxBarDelete: TdxBarButton;
    dxRibbon1: TdxRibbon;
    dxRibbon1Tab1: TdxRibbonTab;
    QPerusahaan: TUniQuery;
    DsPerusahaan: TDataSource;
    procedure ActBaruExecute(Sender: TObject);
    procedure ActUpdateExecute(Sender: TObject);
    procedure ActROExecute(Sender: TObject);
    procedure ActDelExecute(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    procedure  refresh;
  end;

var
  FListPerusahaan: TFListPerusahaan;

implementation

{$R *.dfm}

uses UNew_Perusahaan, UDataModule;

procedure TFListPerusahaan.refresh;
begin
   with QPerusahaan do
   begin
       close;
       sql.Clear;
       sql.Text:='select * from master_data.T_company ';
       open;
   end;
   QPerusahaan.Close;
   QPerusahaan.Open;
end;

procedure TFListPerusahaan.ActBaruExecute(Sender: TObject);
begin
  FNewPerusahaan.Caption:='New Perusahaan';
  FNewPerusahaan.Showmodal;
end;

procedure TFListPerusahaan.ActDelExecute(Sender: TObject);
begin
    if messageDlg ('Anda Yakin Akan Menghapus Data '+DBGridPerusahaan.Fields[1].AsString+' '+ '?', mtInformation,  [mbYes]+[mbNo],0) = mrYes then
    begin
      with dm.Qtemp do
      begin
        Close;
        sql.Clear;
        sql.Text:='Delete From master_data.t_company where supplier_code='+QuotedStr(DBGridPerusahaan.Fields[0].AsString);
        Execute;
      end;
      ActROExecute(sender);
      ShowMessage('Data Berhasil di Hapus');
    end;
end;

procedure TFListPerusahaan.ActROExecute(Sender: TObject);
begin
   refresh;
   DBGridPerusahaan.StartLoadingStatus();
   DBGridPerusahaan.FinishLoadingStatus();
end;

procedure TFListPerusahaan.ActUpdateExecute(Sender: TObject);
begin
    FNewPerusahaan.Show;
    FNewPerusahaan.BSimpan.Visible:=False;
    FNewPerusahaan.BEdit.Visible:=True;
    FNewPerusahaan.Caption:='Update Perusahaan';
    FNewPerusahaan.Ed_kode.Enabled:=False;
    with Qperusahaan do
    begin
      FNewPerusahaan.Ed_kode.Text:=Qperusahaan.FieldByName('company_code').AsString;
      FNewPerusahaan.Ed_nama.Text:=Qperusahaan.FieldByName('company_name').AsString;
      FNewPerusahaan.cb_jenis_usaha.Text:=Qperusahaan.FieldByName('type_of_business').AsString;
      FNewPerusahaan.Ed_alamat.Text:=Qperusahaan.FieldByName('address').AsString;
      FNewPerusahaan.Ed_telp.Text:=Qperusahaan.FieldByName('telp').AsString;
      FNewPerusahaan.Ed_email.Text:=Qperusahaan.FieldByName('email').AsString;
      FNewPerusahaan.Ed_NPWP.Text:=Qperusahaan.FieldByName('npwp').AsString;
      FNewPerusahaan.Cb_status_pajak.Text:=Qperusahaan.FieldByName('status_pajak').AsString;
      FNewPerusahaan.Cb_mata_uang.Text:=Qperusahaan.FieldByName('currency').AsString;

    end;
end;

end.
