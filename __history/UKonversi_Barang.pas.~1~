unit UKonversiBarang;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, Vcl.Buttons,
  DBGridEhGrouping, ToolCtrlsEh, DBGridEhToolCtrls, DynVarsEh, RzCmboBx,
  Data.DB, MemDS, DBAccess, Uni, RzButton, EhLibVCL, GridsEh, DBAxisGridsEh,
  DBGridEh, RzTabs, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, dxRibbonSkins, dxRibbonCustomizationForm, dxBar,
  dxBarExtItems, cxClasses, dxRibbon, dxSkinsCore, dxSkinBlack, dxSkinBlue,
  dxSkinBlueprint, dxSkinCaramel, dxSkinCoffee, dxSkinDarkRoom, dxSkinDarkSide,
  dxSkinDevExpressDarkStyle, dxSkinDevExpressStyle, dxSkinFoggy,
  dxSkinGlassOceans, dxSkinHighContrast, dxSkiniMaginary, dxSkinLilian,
  dxSkinLiquidSky, dxSkinLondonLiquidSky, dxSkinMcSkin, dxSkinMetropolis,
  dxSkinMetropolisDark, dxSkinMoneyTwins, dxSkinOffice2007Black,
  dxSkinOffice2007Blue, dxSkinOffice2007Green, dxSkinOffice2007Pink,
  dxSkinOffice2007Silver, dxSkinOffice2010Black, dxSkinOffice2010Blue,
  dxSkinOffice2010Silver, dxSkinOffice2013DarkGray, dxSkinOffice2013LightGray,
  dxSkinOffice2013White, dxSkinPumpkin, dxSkinSeven, dxSkinSevenClassic,
  dxSkinSharp, dxSkinSharpPlus, dxSkinSilver, dxSkinSpringTime, dxSkinStardust,
  dxSkinSummer2008, dxSkinTheAsphaltWorld, dxSkinsDefaultPainters,
  dxSkinValentine, dxSkinVS2010, dxSkinWhiteprint, dxSkinXmas2008Blue,
  dxSkinsdxRibbonPainter, dxSkinsdxBarPainter;

type
  TFkonversimaterial = class(TForm)
    QKonversiM: TUniQuery;
    DsKonversiM: TDataSource;
    dxBarManager1: TdxBarManager;
    dxRibbon1Tab1: TdxRibbonTab;
    dxRibbon1: TdxRibbon;
    dxBarManager1Bar1: TdxBar;
    dxBarButton1: TdxBarButton;
    dxBarButton2: TdxBarButton;
    dxBarButton3: TdxBarButton;
    dxBarButton4: TdxBarButton;
    dxBarBaru: TdxBarLargeButton;
    DBGridEh1: TDBGridEh;
    procedure BBaruClick(Sender: TObject);
    procedure BBatalClick(Sender: TObject);
    procedure dxBarButton2Click(Sender: TObject);
    procedure dxBarButton3Click(Sender: TObject);
    procedure dxBarBaruClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
  private
    { Private declarations }
    Procedure Refresh;
    procedure Clear;
  public
    { Public declarations }
    Procedure Autonumber;
  end;
function fkonversimaterial:Tfkonversimaterial;
var
 // Fkonversimaterial: TFkonversimaterial;
  urut:integer;

implementation

{$R *.dfm}

uses UDm, UNewKonv_Material;
var
  realfkonvm : Tfkonversimaterial;

// implementasi function
function fkonversimaterial: Tfkonversimaterial;
begin
  if Realfkonvm <> nil then
    fkonversimaterial:= Realfkonvm
  else
    Application.CreateForm(TFkonversimaterial, Result);
end;

procedure TFkonversimaterial.Autonumber;
begin
  with dm.Qtemp do
  begin
  close;
  sql.Clear;
  sql.Text:=' SELECT max(t_konversi_material.no_konversi)AS urut FROM t_konversi_material';
  execsql;
  end;
   urut:=Dm.Qtemp.FieldByName('urut').AsInteger+1;
   FNewKonv_Material.Edno.Text:=FloatToStr(urut);
end;

Procedure TFkonversimaterial.Clear;
begin
  FNewKonv_Material.EdKd.Text:='';
  FNewKonv_Material.EdNm.Text:='';
  FNewKonv_Material.Edqty.Text:='0';
  FNewKonv_Material.Edsatuan.Text:='';
  FNewKonv_Material.EdqtyKon.Text:='0';
  FNewKonv_Material.EdKonversi.Text:='';
  FNewKonv_Material.Edno.Text:='';
end;

procedure TFkonversimaterial.dxBarBaruClick(Sender: TObject);
begin
with FNewKonv_Material do
begin
  Show;
  Self.Clear;
  Self.Autonumber;
 // FNewKonv_Material.BSimpan.Visible:=True;
//  FNewKonv_Material.BEdit.Visible:=False;
  caption:='New Konversi Material';
  Status:=0;
  end;
end;

procedure TFkonversimaterial.dxBarButton2Click(Sender: TObject);
begin
FNewKonv_Material.Show;
//FNewKonv_Material.BSimpan.Visible:=False;
//FNewKonv_Material.BEdit.Visible:=True;
FNewKonv_Material.Caption:='Update Konversi Material';
Status:=1;
with QKonversiM do
begin
  FNewKonv_Material.Edno.Text:=QKonversiM.FieldByName('no_konversi').AsString;
  FNewKonv_Material.EdKd.Text:=QKonversiM.FieldByName('kd_material').AsString;
  FNewKonv_Material.EdNm.Text:=QKonversiM.FieldByName('nm_material').AsString;
  FNewKonv_Material.Edqty.Text:=QKonversiM.FieldByName('qtysatuan').AsString;
  FNewKonv_Material.Edsatuan.Text:=QKonversiM.FieldByName('satuan').AsString;
  FNewKonv_Material.EdqtyKon.Text:=QKonversiM.FieldByName('qtykonversi').AsString;
  FNewKonv_Material.EdKonversi.Text:=QKonversiM.FieldByName('konversi').AsString;
  FNewKonv_Material.Edcategory.Text:=QKonversiM.FieldByName('category').AsString;
end;
end;

procedure TFkonversimaterial.dxBarButton3Click(Sender: TObject);
begin
DBGridEh1.StartLoadingStatus();
Self.Refresh;
DBGridEh1.FinishLoadingStatus();
end;

procedure TFkonversimaterial.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
//Dm.Koneksi.Close;
  Action:=cafree;
end;

procedure TFkonversimaterial.FormCreate(Sender: TObject);
begin
  realfkonvm:=self;
end;

procedure TFkonversimaterial.FormDestroy(Sender: TObject);
begin
  realfkonvm:=nil;
end;

procedure TFkonversimaterial.FormShow(Sender: TObject);
begin
Refresh;
end;

Procedure TFkonversimaterial.Refresh;
begin
  QKonversiM.Close;
  QKonversiM.Open;
end;

procedure TFkonversimaterial.BBaruClick(Sender: TObject);
begin
Self.Clear;
Self.Autonumber;
//Self.Load;
end;

procedure TFkonversimaterial.BBatalClick(Sender: TObject);
begin
  Self.Clear;
  Self.Refresh;
end;


end.
