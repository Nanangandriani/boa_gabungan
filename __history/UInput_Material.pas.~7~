unit UInput_Material;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, RzButton,
  Vcl.ExtCtrls, Vcl.Mask, RzEdit, RzBtnEdt, Data.DB, MemDS, DBAccess, Uni,
  RzCmboBx;

type
  TFInput_Material = class(TForm)
    Edjenis: TRzComboBox;
    UniQuery1: TUniQuery;
    EdNm_akun: TRzButtonEdit;
    Edkd_akun: TRzEdit;
    EdMerk: TRzComboBox;
    EdSatuan: TEdit;
    Panel1: TPanel;
    BBatal: TRzBitBtn;
    BSimpan: TRzBitBtn;
    BEdit: TRzBitBtn;
    EdCategory: TRzComboBox;
    Edno: TEdit;
    Edno1: TEdit;
    EdKd: TEdit;
    EdNm: TEdit;
    SpeedButton1: TSpeedButton;
    Label20: TLabel;
    Label19: TLabel;
    Label14: TLabel;
    Label13: TLabel;
    Label12: TLabel;
    Label11: TLabel;
    Label10: TLabel;
    Label9: TLabel;
    Label7: TLabel;
    Label1: TLabel;
    Label5: TLabel;
    Label2: TLabel;
    Label4: TLabel;
    Label6: TLabel;
    Label3: TLabel;
    Label8: TLabel;
    procedure BBatalClick(Sender: TObject);
    procedure SpeedButton1Click(Sender: TObject);
    procedure BSimpanClick(Sender: TObject);
    procedure BEditClick(Sender: TObject);
    procedure EdNm_akunButtonClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FInput_Material: TFInput_Material;
  idmaterial:string;

implementation

{$R *.dfm}

uses UKategori_Material, UDataModule, UAkun_Perkiraan_TerimaMat;

procedure TFInput_Material.BBatalClick(Sender: TObject);
begin
  Close;
end;

procedure TFInput_Material.BEditClick(Sender: TObject);
begin
      if Edjenis.Text='' then
      begin
        MessageDlg('jenis Tidak boleh Kosong ',MtWarning,[MbOk],0);
        Edjenis.SetFocus;
        Exit;
      end;
      if EdCategory.Text='' then
      begin
        MessageDlg('Category Tidak boleh Kosong ',MtWarning,[MbOk],0);
        EdCategory.SetFocus;
        Exit;
      end;
      if EdKd.Text='' then
      begin
        MessageDlg('Kode Material Tidak boleh Kosong ',MtWarning,[MbOk],0);
        EdKd.SetFocus;
        Exit;
      end;
      if EdNm.Text='' then
      begin
        MessageDlg('Nama Material Tidak boleh Kosong ',MtWarning,[MbOk],0);
        EdNm.SetFocus;
        Exit;
      end;
      if EdSatuan.Text='' then
      begin
        MessageDlg('Satuan Tidak boleh Kosong ',MtWarning,[MbOk],0);
        EdSatuan.SetFocus;
        Exit;
      end;
       with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:='Select * from t_material';
        ExecSQL;
      end;
      if not dm.koneksi.InTransaction then
      dm.koneksi.StartTransaction;
      try
      begin
       with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:=' Update t_material set no_urut=:parno_urut,kd_material=:parkd_material,'+
                  ' nm_material=:parnm_material,satuan=:parsatuan,merk=:parmerk,jenis=:parjenis,'+
                  ' kd_akun=:parkd_akun, no_material=:parno_material,category=:parcategory '+
                  ' where id=:parid';
                  ParamByName('parno_urut').Value:=Edno1.Text;
                  ParamByName('parkd_material').Value:=EdKd.Text;
                  ParamByName('parnm_material').Value:=EdNm.Text;
                  ParamByName('parsatuan').Value:=EdSatuan.Text;
                  ParamByName('parmerk').Value:=EdMerk.Text;
                  ParamByName('parjenis').Value:=Edjenis.Text;
                  ParamByName('parkd_akun').Value:=Edkd_akun.Text;
                  ParamByName('parno_material').Value:=Edno.Text;
                  ParamByName('parcategory').Value:=EdCategory.Text;
                  ParamByName('parid').Value:=idmaterial;
        ExecSQL;
        end;
      dm.koneksi.Commit;
      Messagedlg('Data Berhasil di Simpan',MtInformation,[Mbok],0);
        BBatalClick(sender);
      end
      Except
      on E :Exception do
      begin
      MessageDlg(E.Message,mtError,[MBok],0);
      dm.koneksi.Rollback;
      end;
      end;
end;

procedure TFInput_Material.BSimpanClick(Sender: TObject);
begin
    if Edjenis.Text='' then
    begin
      MessageDlg('jenis Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Edjenis.SetFocus;
      Exit;
    end;
    if EdCategory.Text='' then
    begin
      MessageDlg('Category Tidak boleh Kosong ',MtWarning,[MbOk],0);
      EdCategory.SetFocus;
      Exit;
    end;
    if EdKd.Text='' then
    begin
      MessageDlg('Kode Material Tidak boleh Kosong ',MtWarning,[MbOk],0);
      EdKd.SetFocus;
      Exit;
    end;
    if EdNm.Text='' then
    begin
      MessageDlg('Nama Material Tidak boleh Kosong ',MtWarning,[MbOk],0);
      EdNm.SetFocus;
      Exit;
    end;
    if EdSatuan.Text='' then
    begin
      MessageDlg('Satuan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      EdSatuan.SetFocus;
      Exit;
    end;
    with dm.Qtemp do
    begin
      close;
      sql.clear;
      sql.Text:='Select * from t_material';
      ExecSQL;
    end;
    if not dm.koneksi.InTransaction then
    dm.koneksi.StartTransaction;
    try
    begin
     with dm.Qtemp do
    begin
      close;
      sql.clear;
      sql.Text:='insert into t_material(no_urut,no_material,kd_material,nm_material,category,'+
                ' satuan,merk,jenis,kd_akun)values(:parno_urut,:parno_material,:parkd_material,'+
                ' :parnm_material,:parcategory,:parsatuan,:parmerk,:parjenis,:parkd_akun)';
                ParamByName('parno_urut').Value:=Edno1.Text;
                ParamByName('parno_material').Value:=Edno.Text;
                ParamByName('parkd_material').Value:=EdKd.Text;
                ParamByName('parnm_material').Value:=EdNm.Text;
                ParamByName('parcategory').Value:=EdCategory.Text;
                ParamByName('parsatuan').Value:=EdSatuan.Text;
                ParamByName('parmerk').Value:=EdMerk.Text;
                ParamByName('parjenis').Value:=EdJenis.Text;
                ParamByName('parkd_akun').Value:=edkd_akun.text;
      ExecSQL;
      end;
     dm.koneksi.Commit;
    Messagedlg('Data Berhasil di Simpan',MtInformation,[Mbok],0);
      BBatalClick(sender);
    end
    Except
    on E :Exception do
    begin
    MessageDlg(E.Message,mtError,[MBok],0);
    dm.koneksi.Rollback;
    end;
    end;
end;

procedure TFInput_Material.EdNm_akunButtonClick(Sender: TObject);
begin
    with  FAkun_Perkiraan_TerimaMat do
    begin
      Show;
      if QAkun.Active=false then QAkun.Active:=True;
    end;
end;

procedure TFInput_Material.SpeedButton1Click(Sender: TObject);
begin
  FKategori_Material.show;
end;

end.
