unit UNew_Kategori_Gudang;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, RzButton, Vcl.ExtCtrls, Vcl.StdCtrls;

type
  TFNew_Kategori_Gudang = class(TForm)
    Panel1: TPanel;
    BBatal: TRzBitBtn;
    BSimpan: TRzBitBtn;
    BEdit: TRzBitBtn;
    Ednm: TEdit;
    Label3: TLabel;
    Label2: TLabel;
    Edkd: TEdit;
    Label7: TLabel;
    Label5: TLabel;
    procedure BBatalClick(Sender: TObject);
    procedure BSimpanClick(Sender: TObject);
  private
    { Private declarations }
    procedure save;
    procedure update;
  public
    { Public declarations }
  end;

var
  FNew_Kategori_Gudang: TFNew_Kategori_Gudang;
  status: integer;

implementation

{$R *.dfm}

procedure TFNew_Kategori_Gudang.update;
begin
    with dm.Qtemp do
    begin
      close;
      sql.clear;
      Sql.Text := 'Update t_wh_category set category_code=:category_code,'+
                  'category=:category,updated_at=:updated_at,updated_by=:updated_by '+
                  'Where category_code=:category_code';
      parambyname('category_code').Value:=Edkode.Text;
      parambyname('category').Value:=Ednama.Text;
      parambyname('updated_at').AsDateTime:=Now;
      parambyname('updated_by').AsString:='Admin';
      ExecSQL;
    end;
    MessageDlg('Ubah Berhasil..!!',mtInformation,[MBOK],0);
    Close;
end;

procedure TFNew_Kategori_Gudang.BSimpanClick(Sender: TObject);
begin
    if not dm.Koneksi.InTransaction then
       dm.Koneksi.StartTransaction;
      try
      if Edkode.Text='' then
      begin
        MessageDlg('Kode Kategori Wajib Diisi..!!',mtInformation,[mbRetry],0);
        Edkode.SetFocus;
      end;
      if Ednama.Text='' then
      begin
        MessageDlg('Nama Kategori Wajib Diisi..!!',mtInformation,[mbRetry],0);
        Ednama.SetFocus;
      end;

      if Status = 0 then
      begin
        Save;
        Dm.Koneksi.Commit;
      end
      else
      if Status = 1 then
      begin
        Update;
        Dm.Koneksi.Commit;
      end;
      Except on E :Exception do
        begin
          begin
            MessageDlg(E.ClassName +' : '+E.Message, MtError,[mbok],0);
            Dm.koneksi.Rollback ;
          end;
        end;
      end;
end;

procedure TFNew_Kategori_Gudang.save;
begin
    with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:='Insert into t_wh_category(category_code,category,created_at,created_by ) '+
                  'Values(:category_code,:category,:created_at,:created_by)';
        parambyname('category_code').Value:=Edkode.Text;
        parambyname('category').Value:=Ednama.Text;
        parambyname('created_at').AsDateTime:=Now;
        parambyname('created_by').AsString:='Admin';
        ExecSQL;
      end;
      MessageDlg('Simpan Berhasil..!!',mtInformation,[MBOK],0);
      Close;
end;


procedure TFNew_Kategori_Gudang.BBatalClick(Sender: TObject);
begin
  Close;
end;

end.
