unit UNew_Dept;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, RzButton, Vcl.ExtCtrls;

type
  TFNew_Dept = class(TForm)
    Edkd: TEdit;
    Panel2: TPanel;
    BBatal: TRzBitBtn;
    BSimpan: TRzBitBtn;
    EdDept: TEdit;
    Label8: TLabel;
    Label7: TLabel;
    Label2: TLabel;
    Label1: TLabel;
    procedure BBatalClick(Sender: TObject);
    procedure BSimpanClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    procedure Autonumber;
  end;

var
  FNew_Dept: TFNew_Dept;
  Status:integer;

implementation

{$R *.dfm}

uses UDataModule, UDept;


Procedure TFNew_Dept.Autonumber;
begin
  with dm.Qtemp do
  begin
  close;
  sql.clear;
  sql.Text:='select max(dept_code)as no from t_dept';
  ExecSQL;
  end;
  Edkd.Text:=Dm.Qtemp['no'] + 1;
end;

procedure TFNew_Dept.BBatalClick(Sender: TObject);
begin
  Close;
  //FDept.dxbarRefreshClick(sender);
  FDept.ActROExecute(sender);
end;

procedure TFNew_Dept.BSimpanClick(Sender: TObject);
begin
    if Edkd.Text='' then
    begin
      MessageDlg('Kode Department Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Edkd.SetFocus;
      Exit;
    end;
    if EdDept.Text='' then
    begin
      MessageDlg('Department User Tidak boleh Kosong ',MtWarning,[MbOk],0);
      EdDept.SetFocus;
      Exit;
    end;
    if not dm.koneksi.InTransaction then
    dm.koneksi.StartTransaction;
    try
    begin
    if status=0 then
    begin
      with dm.Qtemp do
      begin
        close;
        sql.Clear;
        //sql.Text:='insert into t_dept(no_dept,Dept)values('+QuotedStr(Edkd.Text)+','+
                  //''+QuotedStr(EdDept.Text)+')';
        sql.Text:='insert into t_dept(Dept)values('+QuotedStr(EdDept.Text)+')';
        ExecSQL;
      end;
    end;
    if status=1 then
    begin
      with dm.Qtemp do
      begin
        close;
        sql.Clear;
        sql.Text:=' Update t_dept set dept='+QuotedStr(EdDept.Text)+''+
                  ' where iddept='+QuotedStr(Edkd.Text);
        ExecSQL;
      end;
    end;
    dm.koneksi.Commit;
    Messagedlg('Data Berhasil di Simpan',MtInformation,[Mbok],0);
    BBatalClick(sender);
    end
    Except
    on E :Exception do
    begin
    MessageDlg(E.Message,mtError,[MBok],0);
    dm.koneksi.Rollback;
    end;
    end;
end;

end.
