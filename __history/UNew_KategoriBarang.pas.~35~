unit UNew_KategoriBarang;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, RzButton, Vcl.ExtCtrls, RzBtnEdt,
  Vcl.Mask, RzEdit, Vcl.StdCtrls;

type
  TFNew_KategoriBarang = class(TForm)
    Label6: TLabel;
    Label4: TLabel;
    Label2: TLabel;
    Label5: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    EdKategori: TEdit;
    Edno: TEdit;
    Label19: TLabel;
    Label20: TLabel;
    Edkd_akun: TRzEdit;
    EdNm_akun: TRzButtonEdit;
    Panel1: TPanel;
    BBatal: TRzBitBtn;
    BSimpan: TRzBitBtn;
    EdJenis: TComboBox;
    Edkd_akun1: TRzEdit;
    BCari: TRzBitBtn;
    Edkd: TEdit;
    procedure BSimpanClick(Sender: TObject);
    procedure BBatalClick(Sender: TObject);
    procedure EdnoKeyPress(Sender: TObject; var Key: Char);
    procedure EdJenisKeyPress(Sender: TObject; var Key: Char);
    procedure EdKategoriKeyPress(Sender: TObject; var Key: Char);
    procedure EdNm_akunKeyPress(Sender: TObject; var Key: Char);
    procedure EdNm_akunButtonClick(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormDestroy(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure EdJenisSelect(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure BCariClick(Sender: TObject);
  private
    { Private declarations }
  public
   { Public declarations }
    statustr:integer;
    id,id_type:string;
    procedure clear;
  end;

Function FNew_KategoriBarang: TFNew_KategoriBarang;

implementation

{$R *.dfm}

uses UDataModule, Udafperkiraan, UNew_Barang, UMainMenu, UKategori_Barang;

var RealFNew_KategoriBarang: TFNew_KategoriBarang;
function FNew_KategoriBarang: TFNew_KategoriBarang;
begin
  if RealFNew_KategoriBarang <> nil then FNew_KategoriBarang:= RealFNew_KategoriBarang
  else  Application.CreateForm(TFNew_KategoriBarang, Result);
end;

procedure TFNew_KategoriBarang.clear;
begin
  EdKd.Clear;
  EdKategori.clear;
  EdJenis.Text:='';
  Edkd_akun.Clear;
  Edkd_akun1.Clear;
end;

procedure TFNew_KategoriBarang.BBatalClick(Sender: TObject);
begin
if statustr=3 then
begin
  close;
end;
if statustr<>3 then
begin
  Close;
  FKategori_Barang.Show;
  FKategori_Barang.ActROExecute(sender);
end;
end;

procedure TFNew_KategoriBarang.BCariClick(Sender: TObject);
begin
  FKategori_Barang.Show;
end;

procedure TFNew_KategoriBarang.BSimpanClick(Sender: TObject);
begin
  if statustr=0 then
  begin
    with dm.Qtemp do
    begin
      close;
      sql.Clear;
      sql.Text:='insert into master_data.t_item_category(category,id_type,akun_code,order_no,code)values'+
                '(:ct,:jn,:kd_akun,:no,:code)';
                ParamByName('ct').Value:=EdKategori.Text;
                ParamByName('jn').Value:=id_type;
                ParamByName('kd_akun').Value:=Edkd_akun.Text;
                ParamByName('code').Value:=Edkd.Text;
                ParamByName('no').Value:=Edno.Text;
      ExecSQL;
    end;
  end;
  if statustr=1 then
  begin
    with dm.Qtemp do
    begin
      close;
      sql.Clear;
      sql.Text:='Update master_data.t_item_category set category=:parct,type_id=:parjn,akun_code=:parkd_akun,'+
                ' order_no=:parno,updated_at=now(),code=:code where "id"=:id';
                ParamByName('id').Value:=id;
                ParamByName('parct').Value:=EdKategori.Text;
                ParamByName('parjn').Value:=id_type;
                ParamByName('parkd_akun').Value:=Edkd_akun.Text;
                ParamByName('code').Value:=Edkd.Text;
                ParamByName('parno').Value:=Edno.Text;
      ExecSQL;
    end;
  end;
  BBatalClick(sender);
  ShowMessage('Data Berhasil Ditambahkan');
//  FNew_Barang.Load;
end;

procedure TFNew_KategoriBarang.EdJenisKeyPress(Sender: TObject; var Key: Char);
begin
if key=#13 then
begin
  EdKategori.SetFocus;
end;
end;

procedure TFNew_KategoriBarang.EdJenisSelect(Sender: TObject);
begin
with dm.Qtemp do
begin
  close;
  sql.Clear;
  sql.Text:='select * from master_data.t_item_type where type='+QuotedStr(EdJenis.Text);
  ExecSQL;
end;
//  Edkd_akun1.Text:=Dm.Qtemp['akun_code'];
  id_type:=dm.Qtemp['id'];
end;

procedure TFNew_KategoriBarang.EdKategoriKeyPress(Sender: TObject;
  var Key: Char);
begin
if key=#13 then
begin
  EdNm_akun.SetFocus;
end;
end;

procedure TFNew_KategoriBarang.EdnoKeyPress(Sender: TObject; var Key: Char);
begin
if key=#13 then
begin
  Edjenis.SetFocus;
end;
end;

procedure TFNew_KategoriBarang.EdNm_akunButtonClick(Sender: TObject);
begin
  fdafperkiraan.Show;
  fdafperkiraan.vpanggil:='kategorimaterial';
end;

procedure TFNew_KategoriBarang.EdNm_akunKeyPress(Sender: TObject; var Key: Char);
begin
if key=#13 then
begin
  BSimpan.SetFocus;
end;
end;

procedure TFNew_KategoriBarang.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  Action:=cafree;
end;

procedure TFNew_KategoriBarang.FormCreate(Sender: TObject);
begin
  RealFNew_KategoriBarang:=self;
end;

procedure TFNew_KategoriBarang.FormDestroy(Sender: TObject);
begin
  RealFNew_KategoriBarang:=nil;
end;

procedure TFNew_KategoriBarang.FormShow(Sender: TObject);
begin
  EdJenis.Clear;
  with dm.Qtemp do
  begin
    close;
    sql.Clear;
    sql.Text:='select * from master_data.t_item_type where deleted_at isnull order by created_by ';
    open;
  end;
    dm.Qtemp.First;
    while not dm.Qtemp.Eof do
    begin
      EdJenis.Items.Add(dm.Qtemp['type']);
    dm.Qtemp.Next;
    end;
end;

end.
