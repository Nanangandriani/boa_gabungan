unit UNew_Perusahaan;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, RzButton, Vcl.ExtCtrls,
  RzCmboBx;

type
  TFNewPerusahaan = class(TForm)
    Label19: TLabel;
    Label20: TLabel;
    Label12: TLabel;
    Label11: TLabel;
    Label10: TLabel;
    Label9: TLabel;
    Label4: TLabel;
    Label2: TLabel;
    Label6: TLabel;
    Label5: TLabel;
    Label8: TLabel;
    Label7: TLabel;
    Label14: TLabel;
    Label13: TLabel;
    Panel1: TPanel;
    BBatal: TRzBitBtn;
    BSimpan: TRzBitBtn;
    BEdit: TRzBitBtn;
    Label1: TLabel;
    Label3: TLabel;
    Label15: TLabel;
    Label16: TLabel;
    Ed_kode: TEdit;
    Ed_nama: TEdit;
    Ed_alamat: TEdit;
    Ed_telp: TEdit;
    Ed_email: TEdit;
    Ed_NPWP: TEdit;
    cb_jenis_usaha: TRzComboBox;
    Cb_Mata_uang: TRzComboBox;
    Cb_Status_Pajak: TRzComboBox;
    procedure BBatalClick(Sender: TObject);
    procedure BSimpanClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure BEditClick(Sender: TObject);
  private
    { Private declarations }
    procedure clear;
  public
    { Public declarations }
  end;

var
  FNewPerusahaan: TFNewPerusahaan;

implementation

{$R *.dfm}

uses UDataModule, UMainMenu;



 procedure TFNewPerusahaan.clear;
 begin
    Ed_kode.Text:='';
    Ed_nama.Text:='';
    cb_jenis_usaha.Text:='';
    Ed_alamat.Text:='';
    Ed_telp.Text:='';
    Ed_email.Text:='';
    Ed_npwp.Text:='';
    cb_status_pajak.Text:='';
    cb_mata_uang.Text:='';
    Ed_kode.SetFocus;

 end;

procedure TFNewPerusahaan.BBatalClick(Sender: TObject);
begin
  Close;
  //FMainMenu.ShowInForm;
end;

procedure TFNewPerusahaan.BEditClick(Sender: TObject);
begin
    BEdit.Visible:=false;
    BSimpan.Visible:=true;
    if Ed_kode.Text='' then
    begin
      MessageDlg('Kode Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_kode.SetFocus;
      Exit;
    end;
    if Ed_nama.Text='' then
    begin
      MessageDlg('Nama Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_nama.SetFocus;
      Exit;
    end;
    if cb_jenis_usaha.Text='' then
    begin
      MessageDlg('Jenis Usaha Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Cb_jenis_usaha.SetFocus;
      Exit;
    end;
    if Ed_alamat.Text='' then
    begin
      MessageDlg('alamat Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_alamat.SetFocus;
      Exit;
    end;
    if Ed_telp.Text='' then
    begin
      MessageDlg('Telepon Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_telp.SetFocus;
      Exit;
    end;
    if Ed_email.Text='' then
    begin
      MessageDlg('Email Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_email.SetFocus;
      Exit;
    end;
    if Ed_npwp.Text='' then
    begin
      MessageDlg('NPWP Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_npwp.SetFocus;
      Exit;
    end;
    if cb_status_pajak.Text='' then
    begin
      MessageDlg('Status Pajak Tidak boleh Kosong ',MtWarning,[MbOk],0);
      cb_status_pajak.SetFocus;
      Exit;
    end;
     if cb_mata_uang.Text='' then
    begin
      MessageDlg('Mata Uang Tidak boleh Kosong ',MtWarning,[MbOk],0);
      cb_mata_uang.SetFocus;
      Exit;
    end;
    if not dm.koneksi.InTransaction then
    dm.koneksi.StartTransaction;
    try
    begin
      with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:='Select * from master_data.t_company Order by company_code ASC ';
        ExecSQL;
      end;

      with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:=' Update master_data.t_company set company_name='+QuotedStr(Ed_nama.Text)+ ' ,type_of_business='+QuotedStr(cb_jenis_usaha.Text)+', address='+QuotedStr(Ed_Alamat.Text)+' ,telp='+QuotedStr(Ed_telp.Text)+''+
                  ' ,email='+QuotedStr(Ed_email.Text)+',npwp='+QuotedStr(Ed_NPWP.Text)+',tax_status='+QuotedStr(cb_status_pajak.Text)+',currency='+QuotedStr(cb_mata_uang.Text)+',:updated_at,:updated_by ) '+
                  ' Where company_code='+QuotedStr(Ed_kode.Text);
        parambyname('updated_at').AsDateTime:=Now;
        parambyname('updated_by').AsString:='Admin';

        ExecSQL;
      end;
      dm.koneksi.Commit;
      Messagedlg('Data Berhasil Disimpan',MtInformation,[Mbok],0);
    end
    Except
     on E :Exception do
    begin
      MessageDlg(E.Message,mtError,[MBok],0);
      dm.koneksi.Rollback;
    end;
    end;
    FMainMenu.ShowInForm;
    BBatalClick(sender);

end;

procedure TFNewPerusahaan.BSimpanClick(Sender: TObject);
begin
    if Ed_kode.Text='' then
    begin
      MessageDlg('Kode Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_kode.SetFocus;
      Exit;
    end;
    if Ed_nama.Text='' then
    begin
      MessageDlg('Nama Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_nama.SetFocus;
      Exit;
    end;
    if cb_jenis_usaha.Text='' then
    begin
      MessageDlg('Jenis Usaha Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Cb_jenis_usaha.SetFocus;
      Exit;
    end;
    if Ed_alamat.Text='' then
    begin
      MessageDlg('alamat Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_alamat.SetFocus;
      Exit;
    end;
    if Ed_telp.Text='' then
    begin
      MessageDlg('Telepon Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_telp.SetFocus;
      Exit;
    end;
    if Ed_email.Text='' then
    begin
      MessageDlg('Email Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_email.SetFocus;
      Exit;
    end;
    if Ed_npwp.Text='' then
    begin
      MessageDlg('NPWP Perusahaan Tidak boleh Kosong ',MtWarning,[MbOk],0);
      Ed_npwp.SetFocus;
      Exit;
    end;
    if cb_status_pajak.Text='' then
    begin
      MessageDlg('Status Pajak Tidak boleh Kosong ',MtWarning,[MbOk],0);
      cb_status_pajak.SetFocus;
      Exit;
    end;
     if cb_mata_uang.Text='' then
    begin
      MessageDlg('Mata Uang Tidak boleh Kosong ',MtWarning,[MbOk],0);
      cb_mata_uang.SetFocus;
      Exit;
    end;

    if not dm.koneksi.InTransaction then
    dm.koneksi.StartTransaction;
    try
    begin
      with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:='Select * from master_data.t_company order by company_code ASC ';
        ExecSQL;
      end;

      with dm.Qtemp do
      begin
        close;
        sql.clear;
        sql.Text:='Insert into master_data.t_company (company_code,company_name,type_of_business,address,Telp,email,npwp,tax_status,currency,created_at,created_by) values'+
                  '('+QuotedStr(Ed_kode.Text)+','+QuotedStr(Ed_Nama.Text)+','+QuotedStr(cb_jenis_usaha.Text)+','+QuotedStr(Ed_Alamat.Text)+','+
                  //''+QuotedStr(Ed_Telp.Text)+','+QuotedStr(Ed_email.Text)+','+QuotedStr(Ed_NPWP.Text)+','+QuotedStr(cb_status_pajak.Text)+','+QuotedStr(cb_mata_uang.Text)+' ,now(),''Admin''  )';
                  ''+QuotedStr(Ed_Telp.Text)+','+QuotedStr(Ed_email.Text)+','+QuotedStr(Ed_NPWP.Text)+','+QuotedStr(cb_status_pajak.Text)+','+QuotedStr(cb_mata_uang.Text)+' ,:created_at,:created_by )';
                  parambyname('created_at').AsDateTime:=Now;
                  parambyname('created_by').AsString:='Admin';
        ExecSQL;
      end;
      dm.koneksi.Commit;
      Messagedlg('Data Berhasil di Simpan',MtInformation,[Mbok],0);
      end
    Except
    on E :Exception do
    begin
      MessageDlg(E.Message,mtError,[MBok],0);
      dm.koneksi.Rollback;
    end;
    end;
    FMainMenu.ShowInForm;
    BBatalClick(sender);
end;

procedure TFNewPerusahaan.FormShow(Sender: TObject);
begin
    //Clear;
    //Ed_kode.SetFocus;
    BSimpan.Visible:=True;
    BEdit.Visible:=False;
end;

end.
